{% extends 'base.html' %}

{% block head %}
<div class="panel panel--dark">
    <h1 class="display-3 flex flex-center" style="margin-top: 75px;"></h1>
</div>
<div class="row base-margin-top flex flex-center">
    <div class="col-md-6">
        <div class="steps">
            <div class="step visited">
                <div class="step__icon">
                    <span class="icon-check"></span>
                </div>
                <div class="step__label">Instructions</div>
            </div>
            <div class="step visited">
                <div class="step__icon">1</div>
                <div class="step__label">TASK 1</div>
            </div>
            <div class="step visited">
                <div class="step__icon">2</div>
                <div class="step__label">TASK 2</div>
            </div>
            <div class="step visited">
                <div class="step__icon">3</div>
                <div class="step__label">TASK 3</div>
            </div>
            <div class="step visited">
                <div class="step__icon">4</div>
                <div class="step__label">TASK 4</div>
            </div>
            <div class="step visited">
                <div class="step__icon">5</div>
                <div class="step__label">TASK 5</div>
            </div>
            <div class="step active">
                <div class="step__icon">6</div>
                <div class="step__label">TASK 6</div>
            </div>
            <div class="step">
                <div class="step__icon">END</div>
                <div class="step__label">TASK 7</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block body%}
<div class="row">
    <div class="col-md-2">
        <ul id="vleft" class="tabs tabs--vertical">
            <li id="vleft-1" class="tab">
                <a tabindex="0" href="/">INSTRUCTIONS</a>
            </li>
            <li id="vleft-2" class="tab">
                <a tabindex="0" href="/task1">TASK 1</a>
            </li>
            <li id="vleft-3" class="tab">
                <a tabindex="0" href="/task2">TASK 2</a>
            </li>
            <li id="vleft-4" class="tab">
                <a tabindex="0" href="/task3">TASK 3</a>
            </li>
            <li id="vleft-5" class="tab">
                <a tabindex="0" href="/task4">TASK 4</a>
            </li>
            <li id="vleft-6" class="tab">
                <a tabindex="0" href="/task5">TASK 5</a>
            </li>
            <li id="vleft-7" class="tab active">
                <a tabindex="0" href="/task6">TASK 6</a>
            </li>
            <li id="vleft-8" class="tab">
                <a tabindex="0" href="/task7">TASK 7</a>
            </li>
            <li id="vleft-9" class="tab">
                <a tabindex="0" href="/task8">TASK 8</a>
            </li>
            <li id="vleft-10" class="tab">
                <a tabindex="0" href="/task9">TASK 9</a>
            </li>
            <li id="vleft-11" class="tab">
                <a tabindex="0" href="/task10">TASK 10</a>
            </li>
            <li id="vleft-12" class="tab">
                <a tabindex="0">SOLUTIONS</a>
            </li>
        </ul>
    </div>
    <div class="col-md-9">
        <div id="vleft-content" class="tab-content">
            <div id="vleft-1-content" class="tab-pane">
                <p>INSTRUCTIONS</p>
            </div>
            <div id="vleft-2-content" class="tab-pane">
                <p>TASK 1</p>
            </div>
            <div id="vleft-3-content" class="tab-pane">
                <p>TASK 2</p>
            </div>
            <div id="vleft-4-content" class="tab-pane">
                <p>TASK 3</p>
            <div id="vleft-5-content" class="tab-pane">
                <p>TASK 4</p>
            <div id="vleft-6-content" class="tab-pane">
                <p>TASK 5</p>
            </div>
            <div id="vleft-7-content" class="tab-pane active">
                <p class="text-size-28 text-weight-300">TASK 6</p>
            </div>
            <div id="vleft-8-content" class="tab-pane">
                <p>SOLUTIONS</p>
            </div>
        </div>
    </div>
</div>
<body class="cui" data-theme="dark">
<h4 class="text-size-28 text-weight-300 panel panel--dark">Welcome to ThousandEyes TS Lab</h4>
    <p class="text-size-18 text-weight-300 base-margin-top text-justify">
        After registration is completed we report to super controller which provides controller 1 url. C1 is our "data" channel. We do regular check-in to controller 1,
        we get test configuration changes trough C1 . Online status is based on regular check-in.
        If agent is offline the first thing to check is sc1.thousandeyes.com and c1.thousandeyes.com connectivity.
        Same as registry, SC1 and C1 use TCP port 443.
    </p>
    <pre>
        2022-11-30 16:53:47.260 INFO  [a4927f00] [te.agent.ClusterMasterAdapter] {} Set clustermaster URL to https://sc1.thousandeyes.com
        2022-11-30 16:53:47.260 INFO  [a4927f00] [te.agent.ClusterMasterAdapter] {} Attempting to get controller assignment from https://sc1.thousandeyes.com
        2022-11-30 16:53:48.178 INFO  [a4927f00] [te.agent.ClusterMasterAdapter] {} https://sc1.thousandeyes.com told us we should talk to controller c1.thousandeyes.com
    </pre>
    <p class="text-size-18 text-weight-300 base-margin-top text-justify">
        Quick look at the logs and soon enough we will see familiar ERROR message.
    </p>
    <pre>
        2022-12-01 08:43:47.217 INFO  [a4927f00] [te.agent.ClusterMasterAdapter] {} https://sc1.thousandeyes.com told us we should talk to controller c1.thousandeyes.com
        2022-12-01 08:43:47.218 INFO  [a4927f00] [te.agent.main] {} Agent belongs to region 0
        2022-12-01 08:43:50.337 INFO  [a4927f00] [te.agent.main] {} Calling checkIn to https://c1.thousandeyes.com
        2022-12-01 08:44:35.403 ERROR [a4927f00] [te.agent.main] {} Error calling checkIn: Curl error - Couldn't connect to server
        2022-12-01 08:44:35.407 INFO  [a4927f00] [te.agent.main] {} Initial checkIn failed, sleeping for 30 seconds
    </pre>
    <p class="text-size-18 text-weight-300 base-margin-top text-justify">
        Let's do the ame as for registry, curl, ping and traceroute.
    </p>
    <pre>
        $ curl -vvv https://c1.thousandeyes.com
        *   Trying 75.2.66.34:443...
        * TCP_NODELAY set
        * connect to 75.2.66.34 port 443 failed: Connection timed out
        *   Trying 99.83.133.153:443...
        * TCP_NODELAY set
        * After 85156ms connect time, move on!
        * connect to 99.83.133.153 port 443 failed: Connection timed out
        * Failed to connect to c1.thousandeyes.com port 443: Connection timed out
        * Closing connection 0
        curl: (28) Failed to connect to c1.thousandeyes.com port 443: Connection timed out

        $ ping c1.thousandeyes.com
        PING ab037f6da47723423.awsglobalaccelerator.com (75.2.66.34) 56(84) bytes of data.
        64 bytes from ab037f6da47723423.awsglobalaccelerator.com (75.2.66.34): icmp_seq=1 ttl=114 time=12.2 ms
        64 bytes from ab037f6da47723423.awsglobalaccelerator.com (75.2.66.34): icmp_seq=2 ttl=114 time=8.81 ms
        64 bytes from ab037f6da47723423.awsglobalaccelerator.com (75.2.66.34): icmp_seq=3 ttl=114 time=16.8 ms
        64 bytes from ab037f6da47723423.awsglobalaccelerator.com (75.2.66.34): icmp_seq=4 ttl=114 time=8.30 ms
        64 bytes from ab037f6da47723423.awsglobalaccelerator.com (75.2.66.34): icmp_seq=5 ttl=114 time=8.41 ms
        64 bytes from ab037f6da47723423.awsglobalaccelerator.com (75.2.66.34): icmp_seq=6 ttl=114 time=8.19 ms
        64 bytes from ab037f6da47723423.awsglobalaccelerator.com (75.2.66.34): icmp_seq=7 ttl=114 time=8.10 ms
        64 bytes from ab037f6da47723423.awsglobalaccelerator.com (75.2.66.34): icmp_seq=8 ttl=114 time=12.4 ms
        64 bytes from ab037f6da47723423.awsglobalaccelerator.com (75.2.66.34): icmp_seq=9 ttl=114 time=12.4 ms
        64 bytes from ab037f6da47723423.awsglobalaccelerator.com (75.2.66.34): icmp_seq=10 ttl=114 time=8.65 ms
        64 bytes from ab037f6da47723423.awsglobalaccelerator.com (75.2.66.34): icmp_seq=11 ttl=114 time=11.4 ms
        ^C
        --- ab037f6da47723423.awsglobalaccelerator.com ping statistics ---
        11 packets transmitted, 11 received, 0% packet loss, time 10016ms
        rtt min/avg/max/mdev = 8.097/10.519/16.840/2.658 ms

        $ sudo te-pathtrace -M tcp -p 443 c1.thousandeyes.com
        [sudo] password for tetraining:
        Trace from 192.168.2.20 to 75.2.66.34:443
        1 *
        2 *
        3 *
        4 *
        5 *
        6 *
        7 *
        8 * (latency=-1)
    </pre>
    <p class="text-size-18 text-weight-300 base-margin-top text-justify">
        Same as with registry.agt.thousandeyes.com, if this was not lab environment you would be able to pinpoint device that is dropping packets.<br>
        In lab scenario it is first device or agent iptable. See <a href="/solutionsT4">solution 4</a> for more information.<br>
        Good job, once again we were able to identify the issue, provide prove in terms of logs and pinpoint to device that is causing the issue.
        Hit FIX task to resolve the issue.
    </p>
    <div class="row base-margin-top base-margin-bottom">
        <div class="col-md-12 flex flex-right">
            <div class="btn-group">
                <button class="btn btn--ghost" style="background-color:#00bceb; color:black;" onclick="window.location.href =/task5/">Previous Task</button>
                <button class="btn btn--ghost" style="background-color:#495057;" onclick="window.location.href =/task6/">View Question</button>
                <button class="btn btn--ghost" style="background-color:#00bceb; color:black;" onclick="window.location.href =/task7/">Next Task</button>
            </div>
        </div>
    </div>
</body>
{% endblock %}